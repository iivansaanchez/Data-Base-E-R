ALTER SESSION SET "_oracle_script"=TRUE;
CREATE USER CALADERO IDENTIFIED BY CALADERO;
GRANT CONNECT, RESOURCE, DBA TO CALADERO;

CREATE TABLE BARCOS
(
MATRICULA VARCHAR(7),
NOMBRE VARCHAR2(20),
CLASE VARCHAR2(10),
ARMADOR VARCHAR2(10),
CAPACIDAD NUMBER(2),
NACIONALIDAD VARCHAR2(20),

CONSTRAINT PK_BARCOS PRIMARY KEY (MATRICULA)
);

CREATE TABLE ESPECIES 
(
CODIGO VARCHAR2(20),
NOMBRE VARCHAR2(20),
TIPO VARCHAR2(15),
CUPO_POR_BARCO NUMBER(2),
CALADERO_PRINCIPAL VARCHAR2(20),

CONSTRAINT PK_ESP PRIMARY KEY (CODIGO)
);

CREATE TABLE CALADERO 
(
CODIGO VARCHAR2(20),
NOMBRE VARCHAR2(20),
UBICACION VARCHAR2(30),
ESPECIE_PRINCIPAL VARCHAR2(20),

CONSTRAINT PK_CAL PRIMARY KEY (CODIGO),
CONSTRAINT FK_CAL FOREIGN KEY (ESPECIE_PRINCIPAL) REFERENCES ESPECIES(CODIGO) ON DELETE SET NULL
);

ALTER TABLE ESPECIES ADD CONSTRAINT FK_ESP FOREIGN KEY (CALADERO_PRINCIPAL) REFERENCES CALADERO(CODIGO);

CREATE TABLE LOTES
(
CODIGO VARCHAR2(20),
MATRICULA VARCHAR2(7),
NUM_KILOS NUMBER(3),
PRECIO_KG_SAL NUMBER(3),
PRECIO_KG_ADJ NUMBER(2),
FECHA_VENTA DATE,
COD_ESPECIE VARCHAR2(20),

CONSTRAINT PK_LOTES PRIMARY KEY (CODIGO),
CONSTRAINT FK_LOTES FOREIGN KEY (MATRICULA) REFERENCES BARCOS(MATRICULA) ON DELETE CASCADE,
CONSTRAINT FK1_LOTES FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIES(CODIGO) ON DELETE CASCADE
);

CREATE TABLE FECHAS_CAPTURAS_PERMITIDAS
(
COD_ESPECIE VARCHAR2(20),
COD_CALADERO VARCHAR2(20),
FECHA_INICIAL DATE,
FECHA_FINAL DATE,

CONSTRAINT PK_FECHA PRIMARY KEY (COD_ESPECIE, COD_CALADERO),
CONSTRAINT FK_FECHA FOREIGN KEY (COD_ESPECIE) REFERENCES ESPECIES(CODIGO),
CONSTRAINT FK2_FECHA FOREIGN KEY (COD_CALADERO) REFERENCES CALADERO(CODIGO)
);


--RESTRICCIONES

ALTER TABLE BARCOS ADD CONSTRAINT CHK_BARCOS CHECK (regexp_like(MATRICULA, '[A-Z][A-Z]-[1-9]{3}'));

ALTER TABLE LOTES ADD CONSTRAINT CHK_LOTES CHECK((FECHA_VENTA) IS NOT NULL);

ALTER TABLE LOTES ADD CONSTRAINT CHK2_LOTES CHECK (PRECIO_KG_ADJ > PRECIO_KG_SAL);

ALTER TABLE LOTES ADD CONSTRAINT CHK3_LOTES CHECK ((NUM_KILOS)>0 AND (PRECIO_KG_ADJ)>0 AND (PRECIO_KG_SAL)>0);

ALTER TABLE CALADERO ADD CONSTRAINT CHK_CALADERO CHECK(UPPER(NOMBRE)=NOMBRE AND UPPER(UBICACION)=UBICACION);

ALTER TABLE FECHAS_CAPTURAS_PERMITIDAS ADD CONSTRAINT CHK1_CALADERO CHECK((EXTRACT (MONTH FROM FECHA_INICIAL)) NOT IN (2) AND (EXTRACT(DAY FROM FECHA_INICIAL)) NOT BETWEEN 2 AND 28);
ALTER TABLE FECHAS_CAPTURAS_PERMITIDAS ADD CONSTRAINT CHK2_CALADERO CHECK((EXTRACT (MONTH FROM FECHA_FINAL)) NOT IN (3) AND (EXTRACT(DAY FROM FECHA_INICIAL)) NOT BETWEEN 1 AND 28);


--1. Añade un nuevo campo a la tabla caladero que almacene el nombre científico.

ALTER TABLE CALADERO ADD NOMBRE_CIENTIFICO VARCHAR2(20);

--2.Inserta dos registros en cada tabla.
ALTER TABLE CALADERO DISABLE CONSTRAINT FK_CAL; 

INSERT INTO CALADERO VALUES ('1', 'UNO', 'DOS', '1', 'TRES');
INSERT INTO CALADERO VALUES ('2', 'DOS', 'TRES', '2', 'CUATRO');

INSERT INTO ESPECIES VALUES ('1', 'PEZ', 'PEZ', 4, '1');
INSERT INTO ESPECIES VALUES ('2', 'PEZ B', 'PEZ B', 5, '2');

ALTER TABLE CALADERO ENABLE CONSTRAINT FK_CAL;

INSERT INTO BARCOS VALUES ('AZ-321', 'SPARROW', 'MARITIMA', '22', '5', 'ESPAÑOLA');
INSERT INTO BARCOS VALUES ('AZ-456', 'JACK', 'MARITIMA', '25', '10', 'ALEMANA');

INSERT INTO FECHAS_CAPTURAS_PERMITIDAS VALUES ('1', '1', TO_DATE('14/04/2002', 'DD/MM/YYYY'), TO_DATE('14/06/2002', 'DD/MM/YYYY'));
INSERT INTO FECHAS_CAPTURAS_PERMITIDAS VALUES ('2', '2', TO_DATE('18/08/2008', 'DD/MM/YYYY'), TO_DATE('20/11/2008', 'DD/MM/YYYY'));

INSERT INTO LOTES VALUES ('1', 'AZ-321', 500, 8, 10, TO_DATE('23/06/2006', 'DD/MM/YYYY'), '1');
INSERT INTO LOTES VALUES ('2', 'AZ-456', 500, 8, 10, TO_DATE('23/06/2009', 'DD/MM/YYYY'), '2');

SELECT * FROM CALADERO;
SELECT * FROM ESPECIES;
SELECT * FROM BARCOS;
SELECT * FROM FECHAS_CAPTURAS_PERMITIDAS;
SELECT * FROM LOTES;

--3.Borra el campo armador de la tabla barco
ALTER TABLE BARCOS DROP (ARMADOR);

--4. Borrar todas las tablas.
DROP TABLE CALADERO CASCADE CONSTRAINT;
DROP TABLE ESPECIES CASCADE CONSTRAINT;
DROP TABLE BARCOS CASCADE CONSTRAINT;
DROP TABLE FECHAS_CAPTURAS_PERMITIDAS CASCADE CONSTRAINT;
DROP TABLE LOTES CASCADE CONSTRAINT;







	


